<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>3D VR Solar System</title>
  <link rel="icon" href="img/icon.png">

  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>

  <script>
    AFRAME.registerComponent('track-planet', {
      schema: {
        orbitalSpeed: { type: 'number', default: 1 }
      },

      init: function () {
        this.camera = this.el.sceneEl.camera.el;
        this.target = null;
        this.isTransitioning = false;
        this.planets = document.querySelectorAll('.planet');
        this.initialOrbitDurations = {}; 

        this.planets.forEach(planet => {
          planet.addEventListener('click', this.onClick.bind(this));
          planet.setAttribute('grabbable', '');
          planet.setAttribute('hoverable', '');

          this.initialOrbitDurations[planet.id] = planet.parentNode.getAttribute('animation__orbit').dur;
        });

        $("#entity-list li a").click(function (event) {
          event.preventDefault();
          var targetId = $(this).text().trim();
          var targetPlanet = document.querySelector('#' + targetId);

          if (targetPlanet) {
            targetPlanet.dispatchEvent(new Event('click'));
          }
        });

        this.initGUI();
        this.updateOrbitDurations(); 
      },

      onClick: function (event) {
        if (this.isTransitioning) return;

        this.target = event.currentTarget;
        this.isTransitioning = true;

        let planetPosition = this.target.getAttribute('position');
        let orbitalRadius = Math.sqrt(planetPosition.x ** 2 + planetPosition.z ** 2) + 2;

        this.camera.setAttribute('animation', {
          property: 'position',
          to: {
            x: planetPosition.x + orbitalRadius,
            y: planetPosition.y + 1,
            z: planetPosition.z
          },
          dur: 1000,
          easing: 'easeInOutQuad',
          from: this.camera.getAttribute('position')
        });

        this.camera.setAttribute('animation__lookat', {
          property: 'rotation',
          to: '0 0 0',
          dur: 1000,
          easing: 'easeInOutQuad'
        });

        this.initialCameraPosition = {
          x: planetPosition.x + orbitalRadius,
          y: planetPosition.y + 1,
          z: planetPosition.z
        };
        this.startTime = Date.now();

        setTimeout(() => {
          this.isTransitioning = false;
        }, 1000);
      },

      tick: function () {
        if (this.target) {
          this.camera.setAttribute('look-at', '#' + this.target.id);

          let targetPosition = this.target.getAttribute('position');
          let orbitalRadius = Math.sqrt(targetPosition.x ** 2 + targetPosition.z ** 2) + 2;

          let elapsed = Date.now() - this.startTime;
          let angle = this.orbitalSpeed * elapsed;

          let x = this.initialCameraPosition.x + orbitalRadius * Math.sin(angle);
          let z = this.initialCameraPosition.z + orbitalRadius * Math.cos(angle);

          this.camera.setAttribute('position', {
            x: x,
            y: this.initialCameraPosition.y,
            z: z
          });
        }

        this.updateOrbitDurations();
      },

      initGUI: function () {
        const gui = new dat.GUI();
        gui.domElement.id = 'gui';
        gui.add(this.data, 'orbitalSpeed', 0.1, 10).name('Orbital Speed').listen()
          .onChange(() => {
            this.updateOrbitDurations();
          });
      },

      updateOrbitDurations: function () {
        this.planets.forEach(planet => {
          const orbitAnimation = planet.parentNode.getAttribute('animation__orbit');
          if (orbitAnimation) {
            const newDur = this.initialOrbitDurations[planet.id] / this.data.orbitalSpeed;
            planet.parentNode.setAttribute('animation__orbit', 'dur', newDur); 
          }
        });
      }
    });
  </script>

  <style>
    .orbit-path {
      geometry: primitive: torus;
      radius: 1;
      radiusTubular: 0.01;
      segmentsTubular: 100;
      material: color: white;
      visible: false;
    }

    /* Entity List Styling */
    .entity-list-wrapper {
      position: fixed;
      top: 60px; 
      left: 10px;
      width: 200px;
      background-color: rgba(0, 0, 0, 0.5); 
      padding: 10px;
      color: white;
      z-index: 100; 
    }

    #entity-list li {
      margin-bottom: 5px;
    }

    #entity-list a {
      color: white;
      text-decoration: none;
    }

    /* Button Styling */
    button {
      position: fixed;
      top: 10px;
      padding: 10px 20px;
      background-color: rgba(0, 0, 0, 0.5); 
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      z-index: 100;
    }

    #toggleOrbitsBtn {
      left: 230px;
    }

    /* Slider Styling */
    .slider-wrapper {
      position: fixed; 
      top: 10px;
      left: 410px; 
      z-index: 100; 
      color: white; 
    }

    #speedSlider {
      width: 200px; 
    }

    /* Improved GUI Styling */
    #gui {
      position: fixed; 
      top: 10px;
      left: 10px;
      z-index: 100; 
      background-color: rgba(0, 0, 0, 0.8); 
      color: #ffffff; 
      font-family: sans-serif;
      border: 2px solid #666666;
      border-radius: 5px;
    }

    #gui .property-name {
      color: #ffff00; 
    }

    #gui .c input[type=text],
    #gui .c input[type=number],
    #gui .c select {
      background-color: #111111;
      color: #eeeeee; 
      border: 1px solid #333333; 
    }

    #gui .slider-fg { 
      background-color: #00ffff;
    }
  </style>
</head>

<body>
  <div id="gui"></div>
  <div class="entity-list-wrapper">
    <h2>Entities</h2>
    <ul id="entity-list">
      <li><a href="#">Sun</a></li>
      <li><a href="#">Mercury</a></li>
      <li><a href="#">Venus</a></li>
      <li><a href="#">Earth</a></li>
      <li><a href="#">Mars</a></li>
      <li><a href="#">Jupiter</a></li>
      <li><a href="#">Saturn</a></li>
      <li><a href="#">Uranus</a></li>
      <li><a href="#">Neptune</a></li>
      <li><a href="#">2005 EU95</a></li>
      <li><a href="#">2017 TB1</a></li>
      <li><a href="#">2022 UF4</a></li>
      <li><a href="#">2024 RO2</a></li>
    </ul>
  </div>

  <button id="toggleOrbitsBtn">Show/Hide Orbits</button>
  <div class="slider-wrapper">
    <label for="speedSlider">Orbit Speed:</label>
    <input type="range" id="speedSlider" min="1" max="10" value="5" step="1">
  </div>

  <a-scene vr-mode-ui="enabled: true">
    <a-assets>
      <img id="sunText" src="img/sun.jpg">
      <img id="mercuryText" src="img/mercury.jpg">
      <img id="venusText" src="img/venus_atmosphere.jpg">
      <img id="earthText" src="img/earth.jpg">
      <img id="earthCloudsText" src="img/earth_clouds.png">
      <img id="marsText" src="img/mars.jpg">
      <img id="jupiterText" src="img/jupiter.jpg">
      <img id="saturnText" src="img/saturn.jpg">
      <img id="saturnRingText" src="img/saturn.jpg">
      <img id="uranusText" src="img/uranus.jpg">
      <img id="neptuneText" src="img/neptune.jpg">
      <img id="skyText" src="img/stars.jpg">
      <img id="moonText" src="img/moon.jpg">
      <img id="astreoid" src="img/asteroid.jpg">
      <img id="comet" src="img/comet.jpg">
    </a-assets>

    <a-entity track-planet>
      <a-camera wasd-controls="acceleration: 300" look-controls="gyroEnabled: true" position="0 5 0"
        rotation="-90 0 0"></a-camera>
    </a-entity>

    <a-sky src="#skyText"></a-sky>
    <a-light type="ambient" color="#222"></a-light>
    <a-light type="spot" angle="180" color="#fff0da" intensity="1.5" position="-20 1.25 -5"></a-light>

    <a-entity id="Sun" class="planet" geometry="primitive: sphere; radius:6;" position="-20 1.25 -5"
      material="shader: flat; src: #sunText"
      animation__rotate="property: rotation; to: 0 -360 0; easing: linear; loop: true; dur: 250000">
    </a-entity>

    <!-- Mercury -->
    <a-entity position="-20 1.25 -5" rotation="0 20 0" 
              animation__orbit="property: rotation; to: 0 380 0; easing: linear; loop: true; dur: 88000">
      <a-entity id="Mercury" class="planet" geometry="primitive: sphere; radius:.1;" position="8 1.25 -5"
        material="src: #mercuryText"
        animation__rotate="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 59000">
      </a-entity>
      <a-entity class="orbit-path" radius="8"></a-entity>
    </a-entity>

    <!-- Venus -->
    <a-entity position="-20 1.25 -5" rotation="0 -80 0" 
              animation__orbit="property: rotation; to: 0 280 0; easing: linear; loop: true; dur: 225000">
      <a-entity id="Venus" class="planet" geometry="primitive: sphere; radius:.3;" position="11 1.25 -5"
        material="src: #venusText"
        animation__rotate="property: rotation; to: 0 -360 0; easing: linear; loop: true; dur: 243000">
      </a-entity>
      <a-entity class="orbit-path" radius="11"></a-entity>
    </a-entity>

    <!-- Earth  -->
    <a-entity id="earthOrbit" position="-20 1.25 -5" rotation="0 -20 0" 
              animation__orbit="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 365000">
      <a-entity id="Earth" class="planet" geometry="primitive: sphere; radius:.3;" position="14 0 0"
        material="src: #earthText"
        animation__rotate="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 1000">
        <a-sphere transparent="true" radius=".3" src="#earthCloudsText"></a-sphere>
        <a-entity id="moon" class="planet" geometry="primitive: sphere; radius: 0.081;" position="1.5 0 0"
          material="src: #moonText"
          animation__orbit="property: position; to: 1.5 0 0; dir: alternate; dur: 27000; loop: true; easing: linear">
        </a-entity>
      </a-entity>
      <a-entity class="orbit-path" radius="14"></a-entity>
    </a-entity>

    <!-- Mars  -->
    <a-entity position="-20 1.25 -5" rotation="0 -20 0" 
              animation__orbit="property: rotation; to: 0 340 0; easing: linear; loop: true; dur: 687000">
      <a-entity id="Mars" class="planet" geometry="primitive: sphere; radius:.15;" position="17 1.25 -5"
        material="src: #marsText"
        animation__rotate="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 1050">
      </a-entity>
      <a-entity class="orbit-path" radius="17"></a-entity>
    </a-entity>

    <!-- Jupiter  -->
    <a-entity position="-20 1.25 -5" rotation="0 0 0" 
              animation__orbit="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 4333000">
      <a-entity id="Jupiter" class="planet" geometry="primitive: sphere; radius:1;" position="22 1.25 -5"
        material="src: #jupiterText"
        animation__rotate="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 4000">
      </a-entity>
      <a-entity class="orbit-path" radius="22"></a-entity>
    </a-entity>

    <!-- Saturn  -->
    <a-entity position="-20 1.25 -5" rotation="0 -100 0" 
              animation__orbit="property: rotation; to: 0 260 0; easing: linear; loop: true; dur: 10759000">
      <a-entity id="Saturn" class="planet" geometry="primitive: sphere; radius:.7;" position="28 1.25 -5"
        material="src: #saturnText"
        animation__rotate="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 4250">
        <a-cylinder transparent="true" src="img/ring.png" height=".0001" radius="1.5" rotation="10 10 20"
          animation__rotate="property: rotation; to: 0 -360 0; easing: linear; loop: true; dur: 4000">
        </a-cylinder>
      </a-entity>
      <a-entity class="orbit-path" radius="28"></a-entity>
    </a-entity>

    <!-- Uranus  -->
    <a-entity position="-20 1.25 -5" rotation="0 80 0" 
              animation__orbit="property: rotation; to: 0 440 0; easing: linear; loop: true; dur: 30687000">
      <a-entity id="Uranus" class="planet" geometry="primitive: sphere; radius:.5;" position="33 1.25 -5"
        material="src: #uranusText"
        animation__rotate="property: rotation; to: 0 -360 0; easing: linear; loop: true; dur: 6500">
      </a-entity>
      <a-entity class="orbit-path" radius="33"></a-entity>
    </a-entity>

    <!-- Neptune  -->
    <a-entity position="-20 1.25 -5" rotation="0 -100 0" 
              animation__orbit="property: rotation; to: 0 260 0; easing: linear; loop: true; dur: 60190000">
      <a-entity id="Neptune" class="planet" geometry="primitive: sphere; radius:.4;" position="37 1.25 -5"
        material="src: #neptuneText"
        animation__rotate="property: rotation; to: 0 -360 0; easing: linear; loop: true; dur: 5800">
      </a-entity>
      <a-entity class="orbit-path" radius="37"></a-entity>
    </a-entity>

    <!-- Asteroids and Comets -->
    <a-entity position="-29 1.25 -10" rotation="0 0 0" 
              animation__orbit="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 1000000">
      <a-entity id="2005 EU95" class="planet" geometry="primitive: sphere; radius: 0.2;" position="40 1.25 -5" 
        material="src: #astreoid"
        animation__rotate="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 20000">
      </a-entity>
      <a-entity class="orbit-path" radius="40"></a-entity>
    </a-entity>
    <a-entity position="-35 1.25 -5" rotation="0 0 0" 
              animation__orbit="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 1200000">
      <a-entity id="2017 TB1" class="planet" geometry="primitive: sphere; radius: 0.2;" position="43 1.25 -5" 
        material="src: #astreoid"
        animation__rotate="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 15000">
      </a-entity>
      <a-entity class="orbit-path" radius="43"></a-entity>
    </a-entity>
    <a-entity position="-30 1.25 -5" rotation="0 0 0" 
              animation__orbit="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 800000">
      <a-entity id="2022 UF4" class="planet" geometry="primitive: sphere; radius: 0.05;" position="46 1.25 -5" 
        material="src: #comet"
        animation__rotate="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 23000">
      </a-entity>
      <a-entity class="orbit-path" radius="46"></a-entity>
    </a-entity>
    <a-entity position="-27 1.25 -5" rotation="0 0 0" 
              animation__orbit="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 900000">
      <a-entity id="2024 RO2" class="planet" geometry="primitive: sphere; radius: 0.3;" position="49 1.25 -5" 
        material="src: #comet"
        animation__rotate="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 18000">
      </a-entity>
      <a-entity class="orbit-path" radius="49"></a-entity>
    </a-entity>
  </a-scene>

  <script>
    document.getElementById('toggleOrbitsBtn').addEventListener('click', function () {
      const orbitPaths = document.querySelectorAll('.orbit-path');
      let visible = orbitPaths[0].getAttribute('visible'); 
      visible = !visible;

      orbitPaths.forEach(path => {
        path.setAttribute('visible', visible); 
      });
    });

    const planets = ['Mercury', 'Venus', 'Earth', 'Mars', 'Jupiter', 'Saturn', 'Uranus', 'Neptune', '2005 EU95', '2017 TB1', '2022 UF4', '2024 RO2'];

    document.getElementById('speedSlider').addEventListener('input', function (event) {
      const speedMultiplier = event.target.value;

      planets.forEach(planet => {
        const planetEl = document.getElementById(planet).parentNode;
        const originalDuration = parseInt(planetEl.getAttribute('animation__orbit').dur);
        planetEl.setAttribute('animation__orbit', `dur: ${originalDuration / speedMultiplier}`);
      });
    });

  </script>
</body>

</html>
